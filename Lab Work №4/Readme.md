# Лабораторная работа №4

## Постановка задачи

**Тема**: Проектирование REST API
**Цель работы**: Получить опыт проектирования программного интерфейса.

Для выбранного сервиса системы, предоставляющего API:

1.	Зафиксировать принятые проектные решения (не менее 8) при проектировании API (оформить в виде документации с четким и подробным описанием в виде документа в md-формате). Использовать методы: GET, POST, PUT, DELETE.
(4 балла)
2.	Реализовать соответствующий API (c методами GET, POST). Общее количество методов не менее 6.
(2 балла)
3.	Протестировать API при помощи Postman (дополнить отчетный документ из п.1 результатами тестирования, сопроводив принтскринами из Postman). Минимум 2 теста на каждый Endpoint.
(2 балла)

Повышенная сложность: Реализовать и протестировать дополнительно методы:  PUT и DELETE. (2 балла)

## Описание системы
Данная глава сделана для упрощения понимания эндпоинтов с точки зрения бизнес-модели.
Рассматривается система, представляющая собой агрегатор банковских счетов для ведения статистики.

**Бизнес-логика**:
- Пользователь имеет общий счёт, в который вносит данные со счетов в различных банках.
- Пользователь может указывать информацию о совершённых операциях.
- Совершённые операции имеют категории.
- Пользователь может указывать информацию о повторяющихся операциях в целях прогнозирования или упрощения ввода данных.
- Приложение показывает исторические данные в наглядном виде, и приводит аналитику.

Ниже приведён рисунок с сильно упрощённой моделью приложения, написанной НЕсогласно нотациям.
![Схема приложения](image.png)

## Документация по API

- Используется REST
- Документация по API сделана в стиле Swagger (OpenAPI).
- Разделим эндпоинты на группы согласно сущностям из предметной области.
- Для работы с пользователями используем JWT токены и стандартный набор эндпоинтов.
- Ограничим доступ к эндпоинтам принуждая использовать авторизацию через JWT на все эндпоинты, кроме регистрации, логина (и связанных с ними).
- Не стоит делать эндпоинты на удаление там, где это не обязательно (принцип YAGNI).
- Некоторые эндпоинты имеют ряд ограничений с точки зрения сервера (например, для создания записей на общем счёте должен существовать общий счёт)



Общий набор эндпоинтов изображен на рисунке ниже. Далее в работе будет использоваться только часть из этих эндпоинтов.
![alt text](image-1.png)
![alt text](image-2.png)
![alt text](image-3.png)

Примечание: в рамках рассматриваемого проекта тестирование работоспособности эндпоинтов проводилось через Swagger и через интеграционные тесты. Но так как задача ЛР - работа с Postman, всё те же действия переведены в контект Postman.

### Группа эндпоинтов "Api"
1. **[POST] register**: в теле запроса передаётся логин и пароль, в ответе - ничего.
**Параметры**: email, password
**Ответы**: 200 (успех), 400 (при повторной регистрации)
Тело запроса и ответа:![alt text](image-4.png)
Заголовки запроса и ответа:![alt text](image-6.png)
Тесты:![alt text](image-5.png)
2. **[POST] login**: в теле запроса передаётся логин и пароль (опционально 2FA), в ответе - тип токена, токен доступа, токен обновления и срок активности токена.
**Параметры**: email, password
**Ответы**: 200 (успех)
Тело запроса и ответа:![alt text](image-7.png)
Заголовки запроса и ответа:![alt text](image-8.png)
Тесты:![alt text](image-9.png)

Во всех эндпоинтах ниже используется аутентификация, как на следующем рисунке:
![alt text](image-10.png)

### Группа эндпоинтов "Account"
1. **[POST] /Account/Create**: параметром передаётся базисная сумма, через Auth передаётся токен, в ответе - сообщение об успехе.
**Параметры**: basisSum
**Ответы**: 200 (успех), 401 (для неавторизованных), 403 (при существующем кошельке)
Тело запроса и ответа:![alt text](image-11.png)
Заголовки запроса и ответа:![alt text](image-12.png)
Тесты:![alt text](image-13.png)
2. **[GET] /Account/GetBasisSum**: запрос пустой, через Auth передаётся токен, в ответе базисная сумма.
**Параметры**: отсутствуют
**Ответы**: 200 (успех), 401 (для неавторизованных), 403 (при несуществовании кошелька)
Тело запроса и ответа:![alt text](image-14.png)
Заголовки запроса и ответа:![alt text](image-15.png)
Тесты:![alt text](image-16.png)
3. **[PUT] /Account/Update**: параметром передаётся новая базисная сумма, через Auth передаётся токен, в ответе - id и новая сумма.
**Параметры**: newBasisSum
**Ответы**: 200 (успех), 401 (для неавторизованных), 403 (при несуществовании кошелька)
Тело запроса и ответа:![alt text](image-17.png)
Заголовки запроса и ответа:![alt text](image-18.png)
Тесты:![alt text](image-19.png)

### Группа эндпоинтов "AccountEntry"
1. **[POST] /AccountEntry/Create**: В теле запроса передаётся сумма (отрицательная или положительная), дата и ID категории, через Auth передаётся токен, в ответе - id, дата, сумма, id категории, id аккаунта.
**Параметры**: sum, date, categoryId
**Ответы**: 200 (успех), 401 (для неавторизованных), 403 (при несуществующем кошельке)
Тело запроса и ответа:![alt text](image-20.png)
Заголовки запроса и ответа:![alt text](image-21.png)
Тесты:![alt text](image-22.png)
2. **[GET] /AccountEntry/GetAll**: запрос пустой, через Auth передаётся токен, в ответе список из всех записей в кошельке.
**Параметры**: отсутствуют
**Ответы**: 200 (успех), 401 (для неавторизованных), 403 (при несуществовании кошелька)
Тело запроса и ответа:![alt text](image-23.png)
Заголовки запроса и ответа:![alt text](image-24.png)
Тесты:![alt text](image-25.png)
3. **[PUT] /AccountEntry/Update**: параметром передаётся ID записи, через Auth передаётся токен, в ответе - id, дата, сумма, id категории, id аккаунта.
**Параметры**: accountEntryId
**Ответы**: 200 (успех), 401 (для неавторизованных), 403 (при несуществовании кошелька)
Тело запроса и ответа:![alt text](image-26.png)
Заголовки запроса и ответа:![alt text](image-27.png)
Тесты:![alt text](image-28.png)
4. **[DELETE] /AccountEntry/Delete**: параметром передаётся ID записи, через Auth передаётся токен, в ответе - ничего.
**Параметры**: accountEntryId
**Ответы**: 200 (успех), 401 (для неавторизованных), 403 (при несуществовании кошелька)
Тело запроса и ответа:![alt text](image-29.png)
Заголовки запроса и ответа:![alt text](image-30.png)
Тесты:![alt text](image-31.png)

Полная схема всех эндпоинтов в Swagger с раскрытым описанием предоставлена в *SwaggerUI.pdf*